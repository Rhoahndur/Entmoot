# Entmoot Staging Environment Configuration
# Copy this file to .env.staging and fill in actual values
# Staging uses smaller resources but same security practices as production

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL connection string with PostGIS
DATABASE_URL=postgresql://entmoot_user:SECURE_PASSWORD@entmoot-staging-db.xxxxxxxxxxxx.us-east-1.rds.amazonaws.com:5432/entmoot

# Connection pool settings (smaller for staging)
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=5
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600
DATABASE_ECHO=false
DATABASE_SSL_MODE=require

# ============================================================================
# REDIS/CACHE CONFIGURATION
# ============================================================================

# Redis connection string
REDIS_URL=redis://:SECURE_AUTH_TOKEN@entmoot-redis-staging.xxxxxxxxxxxxx.cache.amazonaws.com:6379/0

# SSL/TLS for Redis
REDIS_SSL_CERTFILE=/path/to/redis/cert.pem
REDIS_SSL_KEYFILE=/path/to/redis/key.pem
REDIS_SSL_CA_CERTS=/path/to/redis/ca.pem
REDIS_SSL_CHECK_HOSTNAME=true

# Redis session configuration
REDIS_SESSION_EXPIRY=86400
REDIS_MAX_CONNECTIONS=20
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# ============================================================================
# STORAGE CONFIGURATION (AWS S3)
# ============================================================================

# Storage provider
STORAGE_PROVIDER=aws

# AWS Credentials
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=us-east-1

# S3 Bucket Configuration
AWS_S3_BUCKET=entmoot-staging-files
AWS_S3_UPLOAD_PREFIX=uploads/
AWS_S3_EXPORT_PREFIX=exports/
AWS_S3_TEMP_PREFIX=temp/
AWS_S3_FORCE_PATH_STYLE=false
AWS_S3_SIGNATURE_VERSION=s3v4

# S3 Object Storage Settings
S3_UPLOAD_EXPIRY=3600
S3_MAX_FILE_SIZE_MB=500
S3_STORAGE_CLASS=STANDARD
S3_MULTIPART_THRESHOLD=104857600

# ============================================================================
# API SERVER CONFIGURATION
# ============================================================================

# Server binding
API_HOST=0.0.0.0
API_PORT=8000
API_BASE_URL=https://api-staging.yourdomain.com

# Uvicorn/ASGI Server
UVICORN_WORKERS=2                     # Smaller worker count for staging
UVICORN_WORKER_CLASS=uvicorn.workers.UvicornWorker
UVICORN_RELOAD=false
UVICORN_LOG_LEVEL=info

# Request/Response Settings
MAX_UPLOAD_SIZE_MB=500
MAX_REQUEST_SIZE=100
REQUEST_TIMEOUT=3600
KEEPALIVE_TIMEOUT=65

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# Secret key for session signing and CSRF protection
SECRET_KEY=staging-secure-random-secret-key-here-generate-with-openssl

# CORS (Cross-Origin Resource Sharing)
ALLOWED_ORIGINS=https://staging.yourdomain.com,https://api-staging.yourdomain.com,http://localhost:3000
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOW_HEADERS=*

# HTTPS Configuration
HTTPS_ONLY=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# Rate Limiting
RATE_LIMIT_ENABLED=false              # Disabled in staging for easier testing
RATE_LIMIT_REQUESTS=1000
RATE_LIMIT_WINDOW=60

# ============================================================================
# LOGGING AND MONITORING
# ============================================================================

# Logging Configuration
LOG_LEVEL=DEBUG                       # More verbose in staging
LOG_FORMAT=json
LOG_OUTPUT=stdout
LOG_FILE_MAX_SIZE_MB=100
LOG_FILE_BACKUP_COUNT=10

# Structured Logging
STRUCTURED_LOGGING=true
INCLUDE_REQUEST_ID=true
INCLUDE_USER_ID=true

# Prometheus Metrics
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_METRICS_PATH=/metrics

# Sentry Error Tracking
SENTRY_ENABLED=true
SENTRY_DSN=https://stagingPublicKey@o0.ingest.sentry.io/0
SENTRY_ENVIRONMENT=staging
SENTRY_TRACES_SAMPLE_RATE=0.5         # Sample more in staging for debugging
SENTRY_PROFILES_SAMPLE_RATE=0.1
SENTRY_RELEASE=0.1.0-staging

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Enable/disable features (all enabled in staging for testing)
FEATURE_OPTIMIZATION=true
FEATURE_GEOSPATIAL_ANALYSIS=true
FEATURE_PDF_EXPORT=true
FEATURE_KMZ_EXPORT=true
FEATURE_DXF_EXPORT=true

# Feature Limits
MAX_CONCURRENT_JOBS=5                 # Reduced for staging
MAX_RETRY_ATTEMPTS=3
RETRY_BACKOFF_FACTOR=2

# Optimization Configuration
OPTIMIZATION_TIMEOUT=3600
OPTIMIZATION_MAX_ITERATIONS=500       # Reduced for faster testing
OPTIMIZATION_POPULATION_SIZE=50
OPTIMIZATION_MUTATION_RATE=0.1
OPTIMIZATION_CROSSOVER_RATE=0.8

# ============================================================================
# EXTERNAL APIS AND INTEGRATIONS
# ============================================================================

# FEMA Floodplain API
FEMA_API_ENABLED=true
FEMA_API_URL=https://www.fema.gov/api/open/fema_web_disasters.geojson
FEMA_API_TIMEOUT=30
FEMA_CACHE_TTL=3600                   # Shorter cache in staging

# USGS Elevation Data API
USGS_API_ENABLED=true
USGS_API_URL=https://elevation.nationalmap.gov/arcgis/rest/services/3DEPElevation/ImageServer/query
USGS_API_TIMEOUT=30

# Weather/Climate Data
WEATHER_API_ENABLED=false
WEATHER_API_KEY=staging-api-key
WEATHER_API_URL=https://api.openweathermap.org/data/2.5/weather

# ============================================================================
# EMAIL CONFIGURATION
# ============================================================================

# SMTP Configuration
SMTP_ENABLED=false
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USERNAME=apikey
SMTP_PASSWORD=SG.staging-sendgrid-api-key
SMTP_USE_TLS=true
SMTP_USE_SSL=false

# Email Settings
EMAIL_FROM=noreply-staging@yourdomain.com
EMAIL_FROM_NAME=Entmoot Staging
EMAIL_SUPPORT=support-staging@yourdomain.com
EMAIL_REPLY_TO=support-staging@yourdomain.com

# ============================================================================
# DATABASE BACKUP AND REPLICATION
# ============================================================================

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *             # Daily at 2 AM UTC
BACKUP_RETENTION_DAYS=7               # Shorter retention in staging
BACKUP_DESTINATION=s3://entmoot-staging-backups

# Replication
DATABASE_REPLICA_ENABLED=false        # No replica in staging
DATABASE_REPLICA_URL=
REPLICATION_LAG_ALERT_THRESHOLD=60

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Cache Configuration
CACHE_TTL_DEFAULT=1800                # Shorter caches for testing
CACHE_TTL_CONSTRAINT_DATA=3600
CACHE_TTL_ELEVATION_DATA=86400

# Database Query Optimization
QUERY_TIMEOUT=300
BATCH_SIZE=1000
INDEX_BATCH_SIZE=10000

# Geospatial Processing
SPATIAL_INDEX_TYPE=GIST
RTREE_ENABLED=true
SIMPLIFICATION_TOLERANCE=0.0001

# ============================================================================
# DEBUGGING AND DEVELOPMENT
# ============================================================================

# Debug Mode (can be enabled in staging for testing)
DEBUG=false

# SQL Query Logging
DATABASE_ECHO=false
SQLALCHEMY_ECHO=false

# Request/Response Logging
LOG_REQUESTS=true                     # Enable for debugging
LOG_RESPONSES=true

# Profile Application Performance
PROFILING_ENABLED=true                # Enable in staging
PROFILING_THRESHOLD=500               # Lower threshold to catch slower operations

# ============================================================================
# DEPLOYMENT INFORMATION
# ============================================================================

# Application Version
APP_VERSION=0.1.0-staging
BUILD_ID=
BUILD_TIMESTAMP=

# Deployment Environment
ENVIRONMENT=staging
REGION=us-east-1
DEPLOYMENT_TYPE=ecs

# ============================================================================
# OBSERVABILITY AND HEALTH CHECKS
# ============================================================================

# Health Check Configuration
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_STORAGE=true
HEALTH_CHECK_EXTERNAL_APIS=false

# Heartbeat/Keepalive
HEARTBEAT_ENABLED=true
HEARTBEAT_INTERVAL=60

# ============================================================================
# TESTING-SPECIFIC CONFIGURATION
# ============================================================================

# Allow test data injection
ALLOW_TEST_DATA=false

# Test email sink (optional: use MailHog or similar)
TEST_EMAIL_SINK=http://mailhog:1025

# ============================================================================
# NOTES FOR STAGING
# ============================================================================

# Purpose of Staging:
# - Mirror production environment closely
# - Test new deployments before production release
# - Run integration and end-to-end tests
# - Validate configuration changes
# - Performance baseline testing
# - User acceptance testing (UAT)

# Differences from Production:
# - Smaller database (t3.small instead of r6i.xlarge)
# - No read replicas
# - Shorter retention periods
# - Lower resource limits
# - More verbose logging
# - Testing/debug features enabled

# Data Management:
# - Use realistic subset of production data
# - Refresh staging data weekly from production backups
# - Anonymize sensitive data (PII, customer names, etc.)
# - Keep test accounts and projects clearly marked

# Access Control:
# - Limited to development and QA teams
# - Same security controls as production
# - Audit all access
# - Rotate credentials regularly

# Testing Workflow:
# 1. Deploy new code to staging
# 2. Run automated integration tests
# 3. Perform manual QA testing
# 4. Load testing (optional)
# 5. Security scanning
# 6. Approval for production deployment

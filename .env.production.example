# Entmoot Production Environment Configuration
# Copy this file to .env.production and fill in actual values
# IMPORTANT: Never commit .env.production to version control

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL connection string with PostGIS
# Format: postgresql://[user[:password]@][netloc][:port][/dbname][?param1=value1&...]
DATABASE_URL=postgresql://entmoot_user:SECURE_PASSWORD@entmoot-prod-db.xxxxxxxxxxxx.us-east-1.rds.amazonaws.com:5432/entmoot

# Connection pool settings
DATABASE_POOL_SIZE=20                 # Number of connections to keep in pool
DATABASE_MAX_OVERFLOW=10              # Additional connections above pool_size
DATABASE_POOL_TIMEOUT=30              # Timeout in seconds to get connection
DATABASE_POOL_RECYCLE=3600            # Recycle connections after N seconds (PostgreSQL idle_in_transaction_session_timeout)
DATABASE_ECHO=false                   # Log SQL queries (disable in production)
DATABASE_SSL_MODE=require             # SSL connection mode: disable, allow, prefer, require, verify-ca, verify-full

# ============================================================================
# REDIS/CACHE CONFIGURATION
# ============================================================================

# Redis connection string
# Format: redis://[:password]@localhost:6379/0
# For cluster: rediscluster://[:password]@node1:6379,node2:6379,node3:6379
REDIS_URL=redis://:SECURE_AUTH_TOKEN@entmoot-redis-prod.xxxxxxxxxxxxx.cache.amazonaws.com:6379/0

# SSL/TLS for Redis
REDIS_SSL_CERTFILE=/path/to/redis/cert.pem
REDIS_SSL_KEYFILE=/path/to/redis/key.pem
REDIS_SSL_CA_CERTS=/path/to/redis/ca.pem
REDIS_SSL_CHECK_HOSTNAME=true

# Redis session configuration
REDIS_SESSION_EXPIRY=86400            # Session expiry in seconds (24 hours)
REDIS_MAX_CONNECTIONS=50              # Max connections to Redis
REDIS_SOCKET_TIMEOUT=5                # Socket timeout in seconds
REDIS_SOCKET_CONNECT_TIMEOUT=5        # Connection timeout in seconds

# ============================================================================
# STORAGE CONFIGURATION (AWS S3)
# ============================================================================

# Storage provider: aws, gcp, or azure
STORAGE_PROVIDER=aws

# AWS Credentials (use IAM role in production, not access keys)
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=us-east-1

# S3 Bucket Configuration
AWS_S3_BUCKET=entmoot-prod-files
AWS_S3_UPLOAD_PREFIX=uploads/
AWS_S3_EXPORT_PREFIX=exports/
AWS_S3_TEMP_PREFIX=temp/
AWS_S3_FORCE_PATH_STYLE=false
AWS_S3_SIGNATURE_VERSION=s3v4

# S3 Object Storage Settings
S3_UPLOAD_EXPIRY=3600                 # Presigned URL expiry in seconds
S3_MAX_FILE_SIZE_MB=500               # Maximum file size in MB
S3_STORAGE_CLASS=STANDARD              # Storage class: STANDARD, GLACIER, INTELLIGENT_TIERING
S3_MULTIPART_THRESHOLD=104857600      # 100MB threshold for multipart upload

# Alternative: GCP Configuration
# GCP_PROJECT_ID=my-project
# GCP_CREDENTIALS_PATH=/path/to/credentials.json
# GCP_BUCKET_NAME=entmoot-prod-files

# Alternative: Azure Configuration
# AZURE_STORAGE_ACCOUNT_NAME=entmootprodfiles
# AZURE_STORAGE_ACCOUNT_KEY=DefaultEndpointsProtocol=https;AccountName=...
# AZURE_CONTAINER_NAME=files

# ============================================================================
# API SERVER CONFIGURATION
# ============================================================================

# Server binding
API_HOST=0.0.0.0
API_PORT=8000
API_BASE_URL=https://api.yourdomain.com

# Uvicorn/ASGI Server
UVICORN_WORKERS=4                     # Number of worker processes (2-4x CPU cores)
UVICORN_WORKER_CLASS=uvicorn.workers.UvicornWorker
UVICORN_RELOAD=false                  # Auto-reload on code changes (development only)
UVICORN_LOG_LEVEL=info

# Request/Response Settings
MAX_UPLOAD_SIZE_MB=500
MAX_REQUEST_SIZE=100
REQUEST_TIMEOUT=3600
KEEPALIVE_TIMEOUT=65

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# Secret key for session signing and CSRF protection
# Generate with: openssl rand -base64 32
SECRET_KEY=your-secure-random-secret-key-here-generate-with-openssl

# CORS (Cross-Origin Resource Sharing)
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com,https://app.yourdomain.com
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOW_HEADERS=*

# HTTPS Configuration
HTTPS_ONLY=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100               # Requests per minute
RATE_LIMIT_WINDOW=60                  # Window in seconds

# ============================================================================
# LOGGING AND MONITORING
# ============================================================================

# Logging Configuration
LOG_LEVEL=INFO                        # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json                       # json or text
LOG_OUTPUT=stdout                     # stdout or file path
LOG_FILE_MAX_SIZE_MB=100
LOG_FILE_BACKUP_COUNT=10

# Structured Logging
STRUCTURED_LOGGING=true
INCLUDE_REQUEST_ID=true
INCLUDE_USER_ID=true

# Prometheus Metrics
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_METRICS_PATH=/metrics

# Sentry Error Tracking (optional)
SENTRY_ENABLED=true
SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/0
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1         # Sample 10% of transactions
SENTRY_PROFILES_SAMPLE_RATE=0.1
SENTRY_RELEASE=0.1.0

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Enable/disable features
FEATURE_OPTIMIZATION=true
FEATURE_GEOSPATIAL_ANALYSIS=true
FEATURE_PDF_EXPORT=true
FEATURE_KMZ_EXPORT=true
FEATURE_DXF_EXPORT=true

# Feature Limits
MAX_CONCURRENT_JOBS=10
MAX_RETRY_ATTEMPTS=3
RETRY_BACKOFF_FACTOR=2

# Optimization Configuration
OPTIMIZATION_TIMEOUT=3600             # Timeout in seconds (1 hour)
OPTIMIZATION_MAX_ITERATIONS=1000
OPTIMIZATION_POPULATION_SIZE=100
OPTIMIZATION_MUTATION_RATE=0.1
OPTIMIZATION_CROSSOVER_RATE=0.8

# ============================================================================
# EXTERNAL APIS AND INTEGRATIONS
# ============================================================================

# FEMA Floodplain API
FEMA_API_ENABLED=true
FEMA_API_URL=https://www.fema.gov/api/open/fema_web_disasters.geojson
FEMA_API_TIMEOUT=30
FEMA_CACHE_TTL=86400                  # Cache for 24 hours

# USGS Elevation Data API
USGS_API_ENABLED=true
USGS_API_URL=https://elevation.nationalmap.gov/arcgis/rest/services/3DEPElevation/ImageServer/query
USGS_API_TIMEOUT=30

# Weather/Climate Data (optional)
WEATHER_API_ENABLED=false
WEATHER_API_KEY=your-api-key-here
WEATHER_API_URL=https://api.openweathermap.org/data/2.5/weather

# ============================================================================
# EMAIL CONFIGURATION (optional)
# ============================================================================

# SMTP Configuration
SMTP_ENABLED=false
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USERNAME=apikey
SMTP_PASSWORD=SG.your-sendgrid-api-key-here
SMTP_USE_TLS=true
SMTP_USE_SSL=false

# Email Settings
EMAIL_FROM=noreply@yourdomain.com
EMAIL_FROM_NAME=Entmoot
EMAIL_SUPPORT=support@yourdomain.com
EMAIL_REPLY_TO=support@yourdomain.com

# ============================================================================
# DATABASE BACKUP AND REPLICATION
# ============================================================================

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 3 * * *             # Cron format: daily at 3 AM UTC
BACKUP_RETENTION_DAYS=30
BACKUP_DESTINATION=s3://entmoot-prod-backups

# Replication
DATABASE_REPLICA_ENABLED=true
DATABASE_REPLICA_URL=postgresql://entmoot_user:PASSWORD@replica.rds.amazonaws.com:5432/entmoot
REPLICATION_LAG_ALERT_THRESHOLD=60    # Alert if lag > 60 seconds

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Cache Configuration
CACHE_TTL_DEFAULT=3600                # Default cache TTL in seconds
CACHE_TTL_CONSTRAINT_DATA=86400       # 24 hours for constraint data
CACHE_TTL_ELEVATION_DATA=604800       # 7 days for elevation data

# Database Query Optimization
QUERY_TIMEOUT=300                     # Query timeout in seconds
BATCH_SIZE=1000                       # Batch size for bulk operations
INDEX_BATCH_SIZE=10000                # Batch size for index creation

# Geospatial Processing
SPATIAL_INDEX_TYPE=GIST               # GIST or BRIN
RTREE_ENABLED=true
SIMPLIFICATION_TOLERANCE=0.0001       # Degrees (approximately 10 meters)

# ============================================================================
# DEBUGGING AND DEVELOPMENT (disable in production)
# ============================================================================

# Debug Mode (NEVER enable in production)
DEBUG=false

# SQL Query Logging
DATABASE_ECHO=false
SQLALCHEMY_ECHO=false

# Request/Response Logging
LOG_REQUESTS=false
LOG_RESPONSES=false

# Profile Application Performance
PROFILING_ENABLED=false
PROFILING_THRESHOLD=1000              # Log if execution > 1000ms

# ============================================================================
# DEPLOYMENT INFORMATION
# ============================================================================

# Application Version
APP_VERSION=0.1.0
BUILD_ID=
BUILD_TIMESTAMP=

# Deployment Environment
ENVIRONMENT=production
REGION=us-east-1
DEPLOYMENT_TYPE=ecs                   # ecs, cloud-run, app-service, kubernetes

# ============================================================================
# OBSERVABILITY AND HEALTH CHECKS
# ============================================================================

# Health Check Configuration
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_STORAGE=true
HEALTH_CHECK_EXTERNAL_APIS=false      # Don't block health check on external APIs

# Heartbeat/Keepalive
HEARTBEAT_ENABLED=true
HEARTBEAT_INTERVAL=60                 # Seconds

# ============================================================================
# NOTES
# ============================================================================

# For AWS:
# - Use IAM roles instead of storing credentials in .env
# - Store sensitive values in AWS Secrets Manager
# - Database password should be at least 32 characters
# - All URLs should use HTTPS in production

# For GCP:
# - Use service accounts with appropriate IAM roles
# - Store credentials in Secret Manager
# - Use Workload Identity for GKE

# For Azure:
# - Use Managed Identities where possible
# - Store secrets in Azure Key Vault
# - Use connection string from Key Vault reference

# Security Guidelines:
# - Rotate SECRET_KEY annually
# - Rotate database passwords quarterly
# - Use different values for each environment
# - Enable MFA for all accounts with access to these values
# - Audit access to credentials regularly
# - Never commit .env files to version control
